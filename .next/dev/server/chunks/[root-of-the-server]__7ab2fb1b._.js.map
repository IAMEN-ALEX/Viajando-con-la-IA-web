{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus/OneDrive/Desktop/viajando-con-ia-web/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Asus/OneDrive/Desktop/viajando-con-ia-web/src/app/api/trips/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nexport async function DELETE(\r\n    req: Request,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const { id } = await params;\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ message: 'ID requerido' }, { status: 400 });\r\n        }\r\n\r\n        await prisma.trip.delete({\r\n            where: { id },\r\n        });\r\n\r\n        return NextResponse.json({ message: 'Viaje eliminado' });\r\n    } catch (error) {\r\n        console.error('Delete trip error:', error);\r\n        return NextResponse.json({ message: 'Error al eliminar viaje' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function PUT(\r\n    req: Request,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const { id } = await params;\r\n        const body = await req.json(); // receive the full trip object\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ message: 'ID requerido' }, { status: 400 });\r\n        }\r\n\r\n        // Update Trip fields\r\n        const updatedTrip = await prisma.trip.update({\r\n            where: { id },\r\n            data: {\r\n                destination: body.destination,\r\n                startDate: body.startDate,\r\n                endDate: body.endDate,\r\n            },\r\n            include: { notes: true } // Return updated notes\r\n        });\r\n\r\n        // Handle Note updates if present\r\n        // Since the UI sends the whole trip with potentially modified note content,\r\n        // we iterate and update them. This is inefficient but supports the strict \"Whole Trip Update\" interface.\r\n        if (body.notes && Array.isArray(body.notes)) {\r\n            await Promise.all(body.notes.map((note: any) =>\r\n                prisma.note.update({\r\n                    where: { id: note.id },\r\n                    data: { content: note.content }\r\n                }).catch(e => console.warn(`Skipping note update for ${note.id}`, e))\r\n                // Catch errors for individual notes (e.g. if deleted concurrently) to not fail the whole request\r\n            ));\r\n        }\r\n\r\n        // Re-fetch to get the absolutely latest state including the just-updated notes\r\n        const finalTrip = await prisma.trip.findUnique({\r\n            where: { id },\r\n            include: { notes: { orderBy: { createdAt: 'desc' } } }\r\n        });\r\n\r\n        return NextResponse.json({ trip: finalTrip });\r\n    } catch (error) {\r\n        console.error('Update trip error:', error);\r\n        return NextResponse.json({ message: 'Error al actualizar viaje' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,OAClB,GAAY,EACZ,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,IAAI,CAAC,IAAI;YACL,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACrB,OAAO;gBAAE;YAAG;QAChB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAkB;IAC1D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA0B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACJ;AAEO,eAAe,IAClB,GAAY,EACZ,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,IAAI,IAAI,IAAI,+BAA+B;QAE9D,IAAI,CAAC,IAAI;YACL,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,qBAAqB;QACrB,MAAM,cAAc,MAAM,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACzC,OAAO;gBAAE;YAAG;YACZ,MAAM;gBACF,aAAa,KAAK,WAAW;gBAC7B,WAAW,KAAK,SAAS;gBACzB,SAAS,KAAK,OAAO;YACzB;YACA,SAAS;gBAAE,OAAO;YAAK,EAAE,uBAAuB;QACpD;QAEA,iCAAiC;QACjC,4EAA4E;QAC5E,yGAAyG;QACzG,IAAI,KAAK,KAAK,IAAI,MAAM,OAAO,CAAC,KAAK,KAAK,GAAG;YACzC,MAAM,QAAQ,GAAG,CAAC,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,OAC9B,gIAAM,CAAC,IAAI,CAAC,MAAM,CAAC;oBACf,OAAO;wBAAE,IAAI,KAAK,EAAE;oBAAC;oBACrB,MAAM;wBAAE,SAAS,KAAK,OAAO;oBAAC;gBAClC,GAAG,KAAK,CAAC,CAAA,IAAK,QAAQ,IAAI,CAAC,CAAC,yBAAyB,EAAE,KAAK,EAAE,EAAE,EAAE;QAG1E;QAEA,+EAA+E;QAC/E,MAAM,YAAY,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAC3C,OAAO;gBAAE;YAAG;YACZ,SAAS;gBAAE,OAAO;oBAAE,SAAS;wBAAE,WAAW;oBAAO;gBAAE;YAAE;QACzD;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAU;IAC/C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACrF;AACJ"}}]
}
module.exports=[71288,e=>{"use strict";var t,n,s,o,a,i,r,l,c,d,u,h,f,p,g,E,m,C,O,R,y,_,I,T,A=e.i(47909),v=e.i(74017),N=e.i(96250),w=e.i(59756),S=e.i(61916),b=e.i(74677),x=e.i(69741),M=e.i(16795),P=e.i(87718),D=e.i(95169),H=e.i(47587),L=e.i(66012),U=e.i(70101),G=e.i(26937),$=e.i(10372),j=e.i(93695);e.i(52474);var F=e.i(220),k=e.i(89171);(t=f||(f={})).STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object",(n=p||(p={})).LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python",(s=g||(g={})).OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let K=["user","model","function","system"];(o=E||(E={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(a=m||(m={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",a.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a.BLOCK_NONE="BLOCK_NONE",(i=C||(C={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",(r=O||(O={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",(l=R||(R={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",l.STOP="STOP",l.MAX_TOKENS="MAX_TOKENS",l.SAFETY="SAFETY",l.RECITATION="RECITATION",l.LANGUAGE="LANGUAGE",l.BLOCKLIST="BLOCKLIST",l.PROHIBITED_CONTENT="PROHIBITED_CONTENT",l.SPII="SPII",l.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",l.OTHER="OTHER",(c=y||(y={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",c.RETRIEVAL_QUERY="RETRIEVAL_QUERY",c.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",c.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",c.CLASSIFICATION="CLASSIFICATION",c.CLUSTERING="CLUSTERING",(d=_||(_={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",d.AUTO="AUTO",d.ANY="ANY",d.NONE="NONE",(u=I||(I={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.MODE_DYNAMIC="MODE_DYNAMIC";class q extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class B extends q{constructor(e,t){super(e),this.response=t}}class Y extends q{constructor(e,t,n,s){super(e),this.status=t,this.statusText=n,this.errorDetails=s}}class V extends q{}class J extends q{}(h=T||(T={})).GENERATE_CONTENT="generateContent",h.STREAM_GENERATE_CONTENT="streamGenerateContent",h.COUNT_TOKENS="countTokens",h.EMBED_CONTENT="embedContent",h.BATCH_EMBED_CONTENTS="batchEmbedContents";class X{constructor(e,t,n,s,o){this.model=e,this.task=t,this.apiKey=n,this.stream=s,this.requestOptions=o}toString(){var e,t;let n=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",s=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",o=`${s}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}async function W(e){var t,n;let s,o=new Headers;o.append("Content-Type","application/json"),o.append("x-goog-api-client",(n=e.requestOptions,s=[],(null==n?void 0:n.apiClient)&&s.push(n.apiClient),s.push("genai-js/0.24.1"),s.join(" "))),o.append("x-goog-api-key",e.apiKey);let a=null==(t=e.requestOptions)?void 0:t.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(e){throw new V(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${e.message}`)}for(let[e,t]of a.entries()){if("x-goog-api-key"===e)throw new V(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new V(`Header name ${e} can only be set using the apiClient field`);o.append(e,t)}}return o}async function Q(e,t,n,s,o,a){let i=new X(e,t,n,s,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(a)),{method:"POST",headers:await W(i),body:o})}}async function z(e,t,n,s,o,a={},i=fetch){let{url:r,fetchOptions:l}=await Q(e,t,n,s,o,a);return Z(r,l,i)}async function Z(e,t,n=fetch){let s;try{s=await n(e,t)}catch(n){var o=n,a=e;let t=o;throw"AbortError"===t.name?(t=new J(`Request aborted when fetching ${a.toString()}: ${o.message}`)).stack=o.stack:o instanceof Y||o instanceof V||((t=new q(`Error fetching from ${a.toString()}: ${o.message}`)).stack=o.stack),t}return s.ok||await ee(s,e),s}async function ee(e,t){let n,s="";try{let t=await e.json();s=t.error.message,t.error.details&&(s+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new Y(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,n)}function et(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),eo(e.candidates[0]))throw new B(`${ea(e)}`,e);return function(e){var t,n,s,o;let a=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.text&&a.push(t.text),t.executableCode&&a.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&a.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}(e)}if(e.promptFeedback)throw new B(`Text not available. ${ea(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),eo(e.candidates[0]))throw new B(`${ea(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),en(e)[0]}if(e.promptFeedback)throw new B(`Function call not available. ${ea(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),eo(e.candidates[0]))throw new B(`${ea(e)}`,e);return en(e)}if(e.promptFeedback)throw new B(`Function call not available. ${ea(e)}`,e)},e}function en(e){var t,n,s,o;let a=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.functionCall&&a.push(t.functionCall);return a.length>0?a:void 0}let es=[R.RECITATION,R.SAFETY,R.LANGUAGE];function eo(e){return!!e.finishReason&&es.includes(e.finishReason)}function ea(e){var t,n,s;let o="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)o+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null==(n=e.promptFeedback)?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(s=e.candidates)?void 0:s[0]){let t=e.candidates[0];eo(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}return o}function ei(e){return this instanceof ei?(this.v=e,this):new ei(e)}"function"==typeof SuppressedError&&SuppressedError;let er=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function el(e){let t=[],n=e.getReader();for(;;){let{done:e,value:s}=await n.read();if(e)return et(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let s of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=s.citationMetadata,n.candidates[e].groundingMetadata=s.groundingMetadata,n.candidates[e].finishReason=s.finishReason,n.candidates[e].finishMessage=s.finishMessage,n.candidates[e].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[e].content||(n.candidates[e].content={role:s.content.role||"user",parts:[]});let t={};for(let o of s.content.parts)o.text&&(t.text=o.text),o.functionCall&&(t.functionCall=o.functionCall),o.executableCode&&(t.executableCode=o.executableCode),o.codeExecutionResult&&(t.codeExecutionResult=o.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(s)}}async function ec(e,t,n,s){return function(e){let t,[n,s]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let n="";return function s(){return t.read().then(({value:t,done:o})=>{let a;if(o)return n.trim()?void e.error(new q("Failed to parse stream")):void e.close();let i=(n+=t).match(er);for(;i;){try{a=JSON.parse(i[1])}catch(t){e.error(new q(`Error parsing JSON response: "${i[1]}"`));return}e.enqueue(a),i=(n=n.substring(i[0].length)).match(er)}return s()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new J("Request aborted when reading from the stream"):new q("Error reading from the stream")})}()}})).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),a=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(e){o[e]&&(s[e]=function(t){return new Promise(function(n,s){a.push([e,t,n,s])>1||r(e,t)})})}function r(e,t){try{var n;(n=o[e](t)).value instanceof ei?Promise.resolve(n.value.v).then(l,c):d(a[0][2],n)}catch(e){d(a[0][3],e)}}function l(e){r("next",e)}function c(e){r("throw",e)}function d(e,t){e(t),a.shift(),a.length&&r(a[0][0],a[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield ei(t.read());if(n)break;yield yield ei(et(e))}})}(n),response:el(s)}}(await z(t,T.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),s))}async function ed(e,t,n,s){let o=await z(t,T.GENERATE_CONTENT,e,!1,JSON.stringify(n),s);return{response:et(await o.json())}}function eu(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function eh(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);var n=t;let s={role:"user",parts:[]},o={role:"function",parts:[]},a=!1,i=!1;for(let e of n)"functionResponse"in e?(o.parts.push(e),i=!0):(s.parts.push(e),a=!0);if(a&&i)throw new q("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!i)throw new q("No content is provided for sending chat message.");return a?s:o}function ef(e){let t;return t=e.contents?e:{contents:[eh(e)]},e.systemInstruction&&(t.systemInstruction=eu(e.systemInstruction)),t}let ep=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],eg={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function eE(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;if(void 0===n||void 0===n.parts||0===n.parts.length)return!1;for(let e of n.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let em="SILENT_ERROR";class eC{constructor(e,t,n,s={}){this.model=t,this.params=n,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(!function(e){let t=!1;for(let n of e){let{role:e,parts:s}=n;if(!t&&"user"!==e)throw new q(`First content should be with role 'user', got ${e}`);if(!K.includes(e))throw new q(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(K)}`);if(!Array.isArray(s))throw new q("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new q("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of s)for(let t of ep)t in e&&(o[t]+=1);let a=eg[e];for(let t of ep)if(!a.includes(t)&&o[t]>0)throw new q(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,s,o,a,i,r;let l;await this._sendPromise;let c=eh(e),d={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(a=this.params)?void 0:a.toolConfig,systemInstruction:null==(i=this.params)?void 0:i.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>ed(this._apiKey,this.model,d,u)).then(e=>{var t;if(eE(e.response)){this._history.push(c);let n=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(n)}else{let t=ea(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var n,s,o,a,i,r;await this._sendPromise;let l=eh(e),c={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(a=this.params)?void 0:a.toolConfig,systemInstruction:null==(i=this.params)?void 0:i.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),t),u=ec(this._apiKey,this.model,c,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(em)}).then(e=>e.response).then(e=>{if(eE(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=ea(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==em&&console.error(e)}),u}}async function eO(e,t,n,s){return(await z(t,T.COUNT_TOKENS,e,!1,JSON.stringify(n),s)).json()}async function eR(e,t,n,s){return(await z(t,T.EMBED_CONTENT,e,!1,JSON.stringify(n),s)).json()}async function ey(e,t,n,s){let o=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await z(t,T.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class e_{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=eu(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let s=ef(e),o=Object.assign(Object.assign({},this._requestOptions),t);return ed(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}async generateContentStream(e,t={}){var n;let s=ef(e),o=Object.assign(Object.assign({},this._requestOptions),t);return ec(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}startChat(e){var t;return new eC(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let s={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(n=null==t?void 0:t.cachedContent)?void 0:n.name,contents:[]},o=null!=e.generateContentRequest;if(e.contents){if(o)throw new V("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let t=eh(e);s.contents=[t]}return{generateContentRequest:s}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return eO(this.apiKey,this.model,n,s)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:eh(e)}:e,s=Object.assign(Object.assign({},this._requestOptions),t);return eR(this.apiKey,this.model,n,s)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return ey(this.apiKey,this.model,e,n)}}class eI{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new q("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new e_(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new V("Cached content must contain a `name` field.");if(!e.model)throw new V("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new V(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new e_(this.apiKey,s,n)}}async function eT(e){try{let{question:t,trips:n}=await e.json(),s=process.env.GOOGLE_GEMINI_API_KEY;if(console.log("[API] Using provider: Google Gemini"),console.log(`[API] API Key present: ${!!s}`),!s)return k.NextResponse.json({response:"Error: API Key de Google Gemini no configurada. Obtén una gratis en https://aistudio.google.com/app/apikey"},{status:500});let o=JSON.stringify(n,null,2),a=`
        Act\xfaa como un asistente de viajes personal experto y amable.
        Tienes acceso a la siguiente informaci\xf3n sobre los viajes del usuario:
        ${o}

        Instrucciones:
        1. Si la respuesta se encuentra en las notas o detalles de los viajes, responde espec\xedficamente bas\xe1ndote en esa informaci\xf3n.
        2. Si la pregunta es sobre un destino que est\xe1 en la lista pero no hay notas espec\xedficas, ofrece recomendaciones generales tur\xedsticas para ese lugar.
        3. Si la pregunta no tiene relaci\xf3n con los viajes listados, responde amablemente de forma general o pide aclarar el contexto.
        4. Mant\xe9n un tono entusiasta y aventurero.
        5. Responde siempre en Espa\xf1ol.
        `,i=new eI(s).getGenerativeModel({model:"gemini-flash-latest"}),r=`${a}

Pregunta del usuario: ${t}`,l=await i.generateContent(r),c=(await l.response).text();if(!c)throw Error("No se recibió respuesta del modelo");return console.log("[API] Response generated successfully"),k.NextResponse.json({response:c})}catch(t){console.error("Error in AI API:",t);let e=t instanceof Error?t.message:String(t);return k.NextResponse.json({response:`Error del asistente: ${e}`},{status:500})}}e.s(["POST",()=>eT],86969);var eA=e.i(86969);let ev=new A.AppRouteRouteModule({definition:{kind:v.RouteKind.APP_ROUTE,page:"/api/ask/route",pathname:"/api/ask",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/ask/route.ts",nextConfigOutput:"",userland:eA}),{workAsyncStorage:eN,workUnitAsyncStorage:ew,serverHooks:eS}=ev;function eb(){return(0,N.patchFetch)({workAsyncStorage:eN,workUnitAsyncStorage:ew})}async function ex(e,t,n){ev.isDev&&(0,w.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/ask/route";s=s.replace(/\/index$/,"")||"/";let o=await ev.prepare(e,t,{srcPage:s,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:a,params:i,nextConfig:r,parsedUrl:l,isDraftMode:c,prerenderManifest:d,routerServerContext:u,isOnDemandRevalidate:h,revalidateOnlyGenerated:f,resolvedPathname:p,clientReferenceManifest:g,serverActionsManifest:E}=o,m=(0,x.normalizeAppPath)(s),C=!!(d.dynamicRoutes[m]||d.routes[p]),O=async()=>((null==u?void 0:u.render404)?await u.render404(e,t,l,!1):t.end("This page could not be found"),null);if(C&&!c){let e=!!d.routes[p],t=d.dynamicRoutes[m];if(t&&!1===t.fallback&&!e){if(r.experimental.adapterPath)return await O();throw new j.NoFallbackError}}let R=null;!C||ev.isDev||c||(R="/index"===(R=p)?"/":R);let y=!0===ev.isDev||!C,_=C&&!y;E&&g&&(0,b.setManifestsSingleton)({page:s,clientReferenceManifest:g,serverActionsManifest:E});let I=e.method||"GET",T=(0,S.getTracer)(),A=T.getActiveScopeSpan(),N={params:i,prerenderManifest:d,renderOpts:{experimental:{authInterrupts:!!r.experimental.authInterrupts},cacheComponents:!!r.cacheComponents,supportsDynamicResponse:y,incrementalCache:(0,w.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:r.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,s,o)=>ev.onRequestError(e,t,s,o,u)},sharedContext:{buildId:a}},k=new M.NodeNextRequest(e),K=new M.NodeNextResponse(t),q=P.NextRequestAdapter.fromNodeNextRequest(k,(0,P.signalFromNodeResponse)(t));try{let o=async e=>ev.handle(q,N).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=T.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==D.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=n.get("next.route");if(o){let t=`${I} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${I} ${s}`)}),a=!!(0,w.getRequestMeta)(e,"minimalMode"),i=async i=>{var l,p;let g=async({previousCacheEntry:r})=>{try{if(!a&&h&&f&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(i);e.fetchMetrics=N.renderOpts.fetchMetrics;let l=N.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=N.renderOpts.collectedTags;if(!C)return await (0,L.sendResponse)(k,K,s,N.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,U.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[$.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==N.renderOpts.collectedRevalidate&&!(N.renderOpts.collectedRevalidate>=$.INFINITE_CACHE)&&N.renderOpts.collectedRevalidate,o=void 0===N.renderOpts.collectedExpire||N.renderOpts.collectedExpire>=$.INFINITE_CACHE?void 0:N.renderOpts.collectedExpire;return{value:{kind:F.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await ev.onRequestError(e,t,{routerKind:"App Router",routePath:s,routeType:"route",revalidateReason:(0,H.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:h})},!1,u),t}},E=await ev.handleResponse({req:e,nextConfig:r,cacheKey:R,routeKind:v.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:d,isRoutePPREnabled:!1,isOnDemandRevalidate:h,revalidateOnlyGenerated:f,responseGenerator:g,waitUntil:n.waitUntil,isMinimalMode:a});if(!C)return null;if((null==E||null==(l=E.value)?void 0:l.kind)!==F.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==E||null==(p=E.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",h?"REVALIDATED":E.isMiss?"MISS":E.isStale?"STALE":"HIT"),c&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,U.fromNodeOutgoingHttpHeaders)(E.value.headers);return a&&C||m.delete($.NEXT_CACHE_TAGS_HEADER),!E.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,G.getCacheControlHeader)(E.cacheControl)),await (0,L.sendResponse)(k,K,new Response(E.value.body,{headers:m,status:E.value.status||200})),null};A?await i(A):await T.withPropagatedContext(e.headers,()=>T.trace(D.BaseServerSpan.handleRequest,{spanName:`${I} ${s}`,kind:S.SpanKind.SERVER,attributes:{"http.method":I,"http.target":e.url}},i))}catch(t){if(t instanceof j.NoFallbackError||await ev.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,H.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:h})},!1,u),C)throw t;return await (0,L.sendResponse)(k,K,new Response(null,{status:500})),null}}e.s(["handler",()=>ex,"patchFetch",()=>eb,"routeModule",()=>ev,"serverHooks",()=>eS,"workAsyncStorage",()=>eN,"workUnitAsyncStorage",()=>ew],71288)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ea290504.js.map